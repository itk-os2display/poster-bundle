/**
 * @name PosterBundle
 * @version v1.0.0
 * @link https://github.com/itk-os2display/poster-bundle
 */
angular.module("posterModule",[]),angular.module("posterModule").config([function(){}]),angular.module("posterModule").directive("posterTool",[function(){"use strict";return{restrict:"E",replace:!0,scope:{slide:"=",close:"&",tool:"="},link:function(s){s.selectType=function(e){s.slide.options.type=e}},templateUrl:"/bundles/os2displayposter/apps/posterModule/posterTool.html"}}]),angular.module("posterModule").directive("posterToolSingle",["$timeout","$http",function(d,g){"use strict";return{restrict:"E",replace:!0,scope:{slide:"=",close:"&",tool:"="},link:function(u){function e(s){jQuery("#os2display-poster--select-single-"+s).select2({ajax:{url:"/api/os2display_poster/search",dataType:"json",delay:500,data:function(e){return{name:e.term,page:e.page||1,type:s}}},minimumInputLength:1})}u.typeSelect="searchName",u.displayOverrides=!1,u.slide.options.overrides||(u.slide.options.overrides={}),d(function(){e("organizers"),e("places"),e("tags")},1e3),u.toggleOverrides=function(){u.displayOverrides=!u.displayOverrides},u.pagerBack=function(){u.pager.centerItem=Math.max(u.pager.centerItem-10,1)},u.pagerForward=function(){u.pager.centerItem=Math.min(u.pager.centerItem+10,u.pager.pagerMax)},u.getPagerPages=function(){u.pager.pages=[];for(var e=parseInt(u.pager.centerItem/10),s=1;s<=10;s++)s+10*e<=u.pager.pagerMax&&u.pager.pages.push(s+10*e);return u.pager.pages},u.calculatePager=function(e){e&&(u.pager={pages:[],currentPage:e.page,pagerMax:e.number_of_pages,itemsPerPage:e.items_per_page,totalResults:e.total_results,centerItem:e.page})},u.search=function(e,s,t,a,r,n,o){u.showSpinner=!0,u.displayEvent=null,u.events=null;var i={};if(o&&(i.page=o),"searchName"===e)i.name=s;else if("searchUrl"===e)i.url=t;else if("searchOrganizer"===e){var l=jQuery("#os2display-poster--select-single-organizers option:selected");i.organizer=l.val()}else if("searchPlace"===e){var c=jQuery("#os2display-poster--select-single-places option:selected");i.place=c.val()}else if("searchTag"===e){var p=jQuery("#os2display-poster--select-single-tags option:selected");i.tag=p.text()}g.get("/api/os2display_poster/events",{params:i}).then(function(e){d(function(){u.events=e.data.events,u.meta=e.data.meta,u.calculatePager(u.meta)})})},u.clickEvent=function(e){u.displayEvent=e,1===u.displayEvent.occurrences.length&&u.clickOccurrence(u.displayEvent.occurrences[0])},u.refreshEvent=function(){g.get("/api/os2display_poster/occurrence",{params:{occurrenceId:u.slide.options.data.occurrenceId}}).then(function(e){d(function(){u.slide.options.data=e.data})})},u.clickOccurrence=function(e){g.get("/api/os2display_poster/occurrence",{params:{occurrenceId:e["@id"]}}).then(function(s){d(function(){if(u.slide.options.data=s.data,u.slide.options.data.endDate){var e=new Date(u.slide.options.data.endDate).getTime();u.slide.schedule_to=parseInt(e/1e3)}})}),u.close()}},templateUrl:"/bundles/os2displayposter/apps/posterModule/posterToolSingle.html"}}]),angular.module("posterModule").directive("posterToolSubscription",["$timeout","$http",function(i,l){"use strict";return{restrict:"E",replace:!0,scope:{slide:"=",close:"&",tool:"="},link:function(n){function o(){n.loadingSearchResults=!0,i(function(){var e=angular.copy(n.slide.options.subscription),s={tags:[],places:[],organizers:[],numberOfResults:e.selectedNumber};for(var t in e.selectedTags)null!=(t=e.selectedTags[t])&&s.tags.push(t.text);for(var a in e.selectedOrganizers)null!=(a=e.selectedOrganizers[a])&&s.organizers.push(a.id);for(var r in e.selectedPlaces)null!=(r=e.selectedPlaces[r])&&s.places.push(r.id);l.get("/api/os2display_poster/search_events",{params:s}).then(function(e){var s=e.data.results;i(function(){n.subscription.foundEvents=s,0<n.subscription.foundEvents.length?n.slide.options.data=n.subscription.foundEvents[0].occurrence:n.slide.options.data=null}),n.loadingSearchResults=!1},function(e){n.loadingSearchResults=!1,console.log("error",e)})})}function e(s,t){var e=jQuery("#os2display-poster--select-subscription-"+s);for(var a in e.select2({ajax:{url:"/api/os2display_poster/search",dataType:"json",delay:500,data:function(e){return{name:e.term,page:e.page||1,type:s}}},minimumInputLength:1}),e.on("select2:select",function(e){var s=e.params.data;t[s.id]=s,o()}),e.on("select2:unselect",function(e){var s=e.params.data;t[s.id]=null,o()}),t)if(a=t[a]){var r=new Option(a.text,a.id,!0,!0);e.append(r).trigger("change")}}n.loading=!0,n.subscription={},n.numberItems=[1,2,3,4,5,6,7,8,9,10],n.slide.options.subscription||(n.slide.options.subscription={selectedPlaces:{},selectedOrganizers:{},selectedTags:{},selectedNumber:5}),i(function(){e("places",n.slide.options.subscription.selectedPlaces),e("organizers",n.slide.options.subscription.selectedOrganizers),e("tags",n.slide.options.subscription.selectedTags),$("#os2display-poster--select-number").on("change",o),n.loading=!1},1e3),o()},templateUrl:"/bundles/os2displayposter/apps/posterModule/posterToolSubscription.html"}}]);